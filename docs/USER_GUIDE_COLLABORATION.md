# 协作功能使用指南

## 概述

团队协作知识库支持实时多人协作编辑，让团队成员可以同时编辑同一篇笔记，实时看到彼此的修改。本指南将帮助您充分利用协作功能。

## 实时协作编辑

### 开始协作

1. **打开笔记**：点击任意笔记进入编辑模式
2. **查看在线用户**：页面顶部会显示当前在线协作者的头像
3. **开始编辑**：直接输入内容，您的修改会实时同步给其他用户

### 协作特性

#### 实时同步
- 所有修改在 100 毫秒内同步到其他用户
- 使用 CRDT 技术自动解决编辑冲突
- 即使网络延迟，最终所有用户看到的内容都会一致

#### 在线状态显示
- **头像显示**：顶部导航栏显示所有在线用户的头像
- **超过 5 人**：显示前 4 个头像和 "+N" 数字
- **悬停查看**：鼠标悬停在头像上可查看用户名和状态
- **编辑指示器**：侧边栏笔记列表中显示"正在编辑"图标

#### 多用户光标
- **实时光标**：看到其他用户的光标位置和用户名标签
- **选区高亮**：其他用户选中的文本会用专属颜色高亮
- **智能堆叠**：多个光标在同一行时会垂直堆叠避免重叠
- **点击跳转**：点击其他用户的光标可快速跳转到该位置

### 离线编辑

如果网络断开：
1. 系统会显示"离线"状态提示
2. 您可以继续编辑，修改会保存在本地
3. 重新连接后，系统会自动同步所有离线修改
4. CRDT 算法确保不会产生冲突

## 邀请协作者

### 添加协作者

1. **打开分享对话框**：
   - 点击笔记页面右上角的"分享"按钮
   - 或使用快捷键 `Ctrl/Cmd + Shift + S`

2. **输入邮箱**：
   - 在输入框中输入协作者的邮箱地址
   - 支持一次添加多个邮箱（用逗号分隔）

3. **选择权限**：
   - **编辑者**：可以修改笔记内容
   - **查看者**：只能查看，不能编辑

4. **发送邀请**：
   - 点击"添加"按钮
   - 系统会发送邮件通知协作者
   - 协作者点击邮件中的链接即可访问笔记

### 管理协作者

在分享对话框中，您可以：
- **查看列表**：看到所有协作者及其权限
- **修改权限**：点击权限下拉菜单更改角色
- **移除协作者**：点击删除图标撤销访问权限
- **查看所有者**：笔记所有者会特别标注

### 权限说明

| 权限 | 查看 | 编辑 | 分享 | 删除 |
|------|------|------|------|------|
| 所有者 | ✓ | ✓ | ✓ | ✓ |
| 编辑者 | ✓ | ✓ | ✗ | ✗ |
| 查看者 | ✓ | ✗ | ✗ | ✗ |

## 公开分享

### 生成公开链接

1. **启用公开分享**：
   - 打开分享对话框
   - 切换"公开分享"开关
   - 系统会自动生成唯一的公开链接

2. **复制链接**：
   - 点击"复制链接"按钮
   - 链接格式：`https://your-domain.com/public/abc123`

3. **分享链接**：
   - 将链接发送给任何人
   - 无需登录即可查看笔记内容

### 公开链接特性

- **只读访问**：访客只能查看，不能编辑
- **图片可见**：笔记中的图片对访客可见
- **注册提示**：访客会看到"注册以编辑"的提示
- **可撤销**：随时可以禁用公开分享，链接立即失效

### 禁用公开分享

1. 打开分享对话框
2. 关闭"公开分享"开关
3. 公开链接立即失效，返回 404 错误

## 版本历史

### 查看历史版本

1. **打开版本历史**：
   - 点击笔记页面右上角的"历史"按钮
   - 或使用快捷键 `Ctrl/Cmd + H`

2. **浏览版本**：
   - 左侧显示所有历史版本列表
   - 每个版本显示时间戳和修改人
   - 点击版本可在右侧预览内容

3. **对比版本**：
   - 选择两个版本进行对比
   - 系统会高亮显示差异

### 恢复历史版本

1. 在版本历史中选择要恢复的版本
2. 点击"恢复此版本"按钮
3. 系统会创建新版本（不会覆盖当前版本）
4. 恢复后可以继续编辑

### 版本保存规则

- 每次保存笔记时自动创建版本
- 每个笔记保留最近 50 个版本
- 超过 50 个版本时，最旧的版本会被删除
- 历史版本不可修改，确保数据完整性

## 最佳实践

### 协作编辑建议

1. **明确分工**：
   - 不同用户编辑不同章节
   - 避免同时编辑同一段落

2. **使用光标**：
   - 关注其他用户的光标位置
   - 避免在他人正在编辑的位置插入内容

3. **及时沟通**：
   - 使用团队聊天工具配合协作
   - 重大修改前通知其他协作者

4. **定期保存**：
   - 虽然系统自动保存，但重要修改后手动保存更安全
   - 使用快捷键 `Ctrl/Cmd + S`

### 权限管理建议

1. **最小权限原则**：
   - 默认给予"查看者"权限
   - 需要编辑时再升级为"编辑者"

2. **定期审查**：
   - 定期检查协作者列表
   - 移除不再需要访问的用户

3. **敏感内容**：
   - 敏感笔记不要启用公开分享
   - 仅邀请必要的协作者

### 性能优化建议

1. **网络环境**：
   - 使用稳定的网络连接
   - 避免在移动网络下编辑大型文档

2. **文档大小**：
   - 单个笔记建议不超过 10,000 字
   - 大型文档考虑拆分为多个笔记

3. **图片使用**：
   - 上传前压缩大图片
   - 单个笔记建议不超过 50 张图片

## 常见问题

### Q: 为什么看不到其他用户的光标？

A: 可能的原因：
- 其他用户超过 30 秒未操作，光标会淡化
- 网络连接问题，尝试刷新页面
- 其他用户已离开笔记

### Q: 编辑冲突如何解决？

A: 系统使用 CRDT 算法自动解决冲突，无需手动处理。所有用户的修改都会被保留并合并。

### Q: 可以撤销其他用户的修改吗？

A: 不能直接撤销。但可以：
- 使用版本历史恢复到之前的版本
- 手动删除不需要的内容

### Q: 公开链接会过期吗？

A: 不会自动过期，除非您手动禁用公开分享。建议定期审查公开分享的笔记。

### Q: 如何知道谁修改了笔记？

A: 查看版本历史，每个版本都会记录修改人和时间戳。

## 快捷键

| 功能 | Windows/Linux | macOS |
|------|---------------|-------|
| 打开分享对话框 | `Ctrl + Shift + S` | `Cmd + Shift + S` |
| 查看版本历史 | `Ctrl + H` | `Cmd + H` |
| 保存笔记 | `Ctrl + S` | `Cmd + S` |
| 查找内容 | `Ctrl + F` | `Cmd + F` |

## 技术支持

如果遇到问题：
1. 检查网络连接
2. 刷新页面重试
3. 查看浏览器控制台错误信息
4. 联系技术支持团队
