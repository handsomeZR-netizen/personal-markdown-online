# ğŸ” åœ¨çº¿éƒ¨ç½²é—®é¢˜è¯Šæ–­

## é—®é¢˜æè¿°
1. âŒ è‡ªåŠ¨ä¿å­˜ç¬”è®°åŠŸèƒ½ä¸å·¥ä½œ
2. âŒ ç‚¹å‡»ä¿å­˜æŒ‰é’®æ—¶å‡ºç°"ä¿å­˜ç¬”è®°å‡ºé”™"

## å¯èƒ½çš„åŸå› 

### 1. æ•°æ®åº“è¿æ¥é—®é¢˜ï¼ˆæœ€å¯èƒ½ï¼‰

#### æ£€æŸ¥ Vercel ç¯å¢ƒå˜é‡
ç¡®ä¿ä»¥ä¸‹ç¯å¢ƒå˜é‡åœ¨ Vercel ä¸­æ­£ç¡®é…ç½®ï¼š

```bash
# å¿…éœ€çš„æ•°æ®åº“ç¯å¢ƒå˜é‡
DATABASE_URL=postgresql://postgres:151692483515156555878@db.llroqdgpohslhfejwxrn.supabase.co:6543/postgres?pgbouncer=true
DIRECT_URL=postgresql://postgres:151692483515156555878@db.llroqdgpohslhfejwxrn.supabase.co:5432/postgres

# è®¤è¯ç¯å¢ƒå˜é‡
AUTH_SECRET=TPa9haEef5cCxxfX5Lm+aZEwY3r1q4gh+3eBvsB+Dvs=

# Supabase å…¬å…±é…ç½®
NEXT_PUBLIC_SUPABASE_URL=https://llroqdgpohslhfejwxrn.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxscm9xZGdwb2hzbGhmZWp3eHJuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2MTcxNjAsImV4cCI6MjA3OTE5MzE2MH0.WIu4gMcByyrkdUhnvcXe4Uxgu7GXpmSN6RzTpX2P5yI

# Supabase ç§å¯†é…ç½®
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxscm9xZGdwb2hzbGhmZWp3eHJuIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MzYxNzE2MCwiZXhwIjoyMDc5MTkzMTYwfQ.xCydSblzA7RnX8f_1lb7zQiXy_coLOXDIBhgDnkYw30
SUPABASE_JWT_SECRET=ED+YLxLQJiDyejzNiFwQgCqjilGD1RLj6hVTceIEoLJVlQSFhk0+vEp2DpOdMHJpAnlMAJs1RE311txVW/V/jQ==

# æ•°æ®åº“å‡­æ®
POSTGRES_USER=postgres
POSTGRES_PASSWORD=151692483515156555878
```

**é…ç½®æ­¥éª¤**ï¼š
1. ç™»å½• [Vercel Dashboard](https://vercel.com)
2. é€‰æ‹©ä½ çš„é¡¹ç›®
3. è¿›å…¥ **Settings** â†’ **Environment Variables**
4. æ£€æŸ¥ä¸Šè¿°å˜é‡æ˜¯å¦éƒ½å­˜åœ¨
5. ç¡®ä¿é€‰æ‹©äº† **Production**, **Preview**, **Development** ç¯å¢ƒ
6. å¦‚æœæœ‰ç¼ºå¤±ï¼Œæ·»åŠ åé‡æ–°éƒ¨ç½²

---

### 2. Prisma Client æœªç”Ÿæˆ

#### æ£€æŸ¥ package.json çš„æ„å»ºè„šæœ¬

ç¡®ä¿ `package.json` ä¸­æœ‰æ­£ç¡®çš„æ„å»ºå‘½ä»¤ï¼š

```json
{
  "scripts": {
    "build": "prisma generate && next build",
    "postinstall": "prisma generate"
  }
}
```

å¦‚æœæ²¡æœ‰ï¼Œéœ€è¦æ·»åŠ è¿™äº›è„šæœ¬ã€‚

---

### 3. æ•°æ®åº“è¡¨æœªåˆ›å»º

#### æ£€æŸ¥ Supabase æ•°æ®åº“

1. ç™»å½• [Supabase Dashboard](https://supabase.com/dashboard)
2. é€‰æ‹©ä½ çš„é¡¹ç›®ï¼š`llroqdgpohslhfejwxrn`
3. è¿›å…¥ **Table Editor**
4. æ£€æŸ¥æ˜¯å¦å­˜åœ¨ä»¥ä¸‹è¡¨ï¼š
   - `User`
   - `Note`
   - `Tag`
   - `Category`
   - `_NoteToTag`ï¼ˆå¤šå¯¹å¤šå…³ç³»è¡¨ï¼‰

å¦‚æœè¡¨ä¸å­˜åœ¨ï¼Œéœ€è¦è¿è¡Œæ•°æ®åº“è¿ç§»ã€‚

---

### 4. æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

#### æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

1. æ‰“å¼€ä½ çš„åœ¨çº¿ç½‘ç«™
2. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° **Console** æ ‡ç­¾
4. å°è¯•ä¿å­˜ç¬”è®°
5. æŸ¥çœ‹çº¢è‰²é”™è¯¯ä¿¡æ¯

å¸¸è§é”™è¯¯ï¼š
- `Failed to fetch` â†’ ç½‘ç»œé—®é¢˜æˆ– API è·¯ç”±ä¸å­˜åœ¨
- `Unauthorized` â†’ è®¤è¯é—®é¢˜
- `500 Internal Server Error` â†’ æœåŠ¡å™¨ç«¯é”™è¯¯ï¼ˆæ•°æ®åº“è¿æ¥å¤±è´¥ï¼‰
- `Prisma Client is not configured` â†’ Prisma æœªæ­£ç¡®ç”Ÿæˆ

---

### 5. Vercel å‡½æ•°æ—¥å¿—

#### æŸ¥çœ‹æœåŠ¡å™¨ç«¯é”™è¯¯

1. ç™»å½• [Vercel Dashboard](https://vercel.com)
2. é€‰æ‹©ä½ çš„é¡¹ç›®
3. è¿›å…¥ **Deployments** â†’ é€‰æ‹©æœ€æ–°éƒ¨ç½²
4. ç‚¹å‡» **Functions** æ ‡ç­¾
5. æŸ¥æ‰¾ `/api/notes` ç›¸å…³çš„å‡½æ•°
6. ç‚¹å‡»æŸ¥çœ‹æ—¥å¿—

å¸¸è§é”™è¯¯ï¼š
- `PrismaClientInitializationError` â†’ æ•°æ®åº“è¿æ¥å¤±è´¥
- `Invalid connection string` â†’ DATABASE_URL æ ¼å¼é”™è¯¯
- `Table does not exist` â†’ æ•°æ®åº“è¡¨æœªåˆ›å»º

---

## ğŸ”§ å¿«é€Ÿä¿®å¤æ­¥éª¤

### æ­¥éª¤ 1: æ£€æŸ¥ç¯å¢ƒå˜é‡

åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­ï¼Œç¡®ä¿æ‰€æœ‰ç¯å¢ƒå˜é‡éƒ½å·²é…ç½®ã€‚

### æ­¥éª¤ 2: é‡æ–°ç”Ÿæˆ Prisma Client

åœ¨æœ¬åœ°è¿è¡Œï¼š

```bash
cd note-app
npx prisma generate
git add .
git commit -m "fix: é‡æ–°ç”Ÿæˆ Prisma Client"
git push
```

### æ­¥éª¤ 3: è¿è¡Œæ•°æ®åº“è¿ç§»

å¦‚æœæ•°æ®åº“è¡¨ä¸å­˜åœ¨ï¼Œè¿è¡Œï¼š

```bash
cd note-app
npx prisma db push
```

### æ­¥éª¤ 4: é‡æ–°éƒ¨ç½²

åœ¨ Vercel Dashboard ä¸­ï¼š
1. è¿›å…¥ **Deployments**
2. ç‚¹å‡»æœ€æ–°éƒ¨ç½²å³ä¾§çš„ **...** èœå•
3. é€‰æ‹© **Redeploy**
4. å‹¾é€‰ **Use existing Build Cache** å–æ¶ˆå‹¾é€‰ï¼ˆå¼ºåˆ¶é‡æ–°æ„å»ºï¼‰
5. ç‚¹å‡» **Redeploy**

---

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. æ·»åŠ è°ƒè¯•æ—¥å¿—

åœ¨ `src/lib/actions/notes.ts` çš„ `autoSaveNote` å‡½æ•°ä¸­æ·»åŠ æ—¥å¿—ï¼š

```typescript
export async function autoSaveNote(
    id: string, 
    data: { title: string; content: string; tagIds?: string[]; categoryId?: string }
): Promise<ActionResult> {
    console.log('ğŸ” autoSaveNote è¢«è°ƒç”¨:', { id, data });
    
    const session = await auth()
    console.log('ğŸ” session:', session);
    
    if (!session?.user?.id) {
        console.error('âŒ æœªæˆæƒ');
        return { success: false, error: t('errors.unauthorized') }
    }

    // ... å…¶ä½™ä»£ç 
}
```

### 2. æµ‹è¯•æ•°æ®åº“è¿æ¥

åˆ›å»ºä¸€ä¸ªæµ‹è¯• API è·¯ç”±ï¼š

```typescript
// src/app/api/test-db/route.ts
import { NextResponse } from 'next/server';
import { prisma } from '@/lib/prisma';

export async function GET() {
  try {
    // æµ‹è¯•æ•°æ®åº“è¿æ¥
    await prisma.$connect();
    
    // æŸ¥è¯¢ç”¨æˆ·æ•°é‡
    const userCount = await prisma.user.count();
    
    return NextResponse.json({
      success: true,
      message: 'æ•°æ®åº“è¿æ¥æˆåŠŸ',
      userCount,
    });
  } catch (error) {
    return NextResponse.json({
      success: false,
      error: error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯',
    }, { status: 500 });
  }
}
```

ç„¶åè®¿é—®ï¼š`https://your-app.vercel.app/api/test-db`

---

## ğŸ“Š é¢„æœŸç»“æœ

### æ­£å¸¸å·¥ä½œæ—¶çš„è¡¨ç°

1. **è‡ªåŠ¨ä¿å­˜**ï¼š
   - ç¼–è¾‘ç¬”è®° 3 ç§’åï¼Œå³ä¸Šè§’æ˜¾ç¤º"ä¿å­˜ä¸­..."
   - ç„¶åæ˜¾ç¤ºç»¿è‰²çš„"å·²ä¿å­˜"âœ“

2. **æ‰‹åŠ¨ä¿å­˜**ï¼š
   - ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
   - æ˜¾ç¤ºæˆåŠŸæç¤º
   - è·³è½¬åˆ°ä»ªè¡¨ç›˜

3. **æµè§ˆå™¨æ§åˆ¶å°**ï¼š
   - æ— çº¢è‰²é”™è¯¯
   - API è¯·æ±‚è¿”å› 200 çŠ¶æ€ç 

---

## ğŸ†˜ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **æµè§ˆå™¨æ§åˆ¶å°çš„å®Œæ•´é”™è¯¯ä¿¡æ¯**ï¼ˆæˆªå›¾æˆ–å¤åˆ¶æ–‡æœ¬ï¼‰
2. **Vercel å‡½æ•°æ—¥å¿—**ï¼ˆä» Vercel Dashboard å¤åˆ¶ï¼‰
3. **ç½‘ç»œè¯·æ±‚è¯¦æƒ…**ï¼š
   - æ‰“å¼€ F12 â†’ Network æ ‡ç­¾
   - å°è¯•ä¿å­˜ç¬”è®°
   - æ‰¾åˆ°å¤±è´¥çš„è¯·æ±‚
   - æŸ¥çœ‹ Response å†…å®¹

è¿™æ ·æˆ‘å¯ä»¥æ›´å‡†ç¡®åœ°å¸®ä½ å®šä½é—®é¢˜ï¼

---

## ğŸ’¡ å¸¸è§è§£å†³æ–¹æ¡ˆ

### é—®é¢˜ï¼šDATABASE_URL æœªé…ç½®

**ç—‡çŠ¶**ï¼š
```
PrismaClientInitializationError: Can't reach database server
```

**è§£å†³**ï¼š
åœ¨ Vercel ç¯å¢ƒå˜é‡ä¸­æ·»åŠ  `DATABASE_URL`

---

### é—®é¢˜ï¼šPrisma Client æœªç”Ÿæˆ

**ç—‡çŠ¶**ï¼š
```
Error: @prisma/client did not initialize yet
```

**è§£å†³**ï¼š
åœ¨ `package.json` ä¸­æ·»åŠ ï¼š
```json
{
  "scripts": {
    "postinstall": "prisma generate"
  }
}
```

---

### é—®é¢˜ï¼šæ•°æ®åº“è¡¨ä¸å­˜åœ¨

**ç—‡çŠ¶**ï¼š
```
Invalid `prisma.note.create()` invocation:
The table `public.Note` does not exist
```

**è§£å†³**ï¼š
è¿è¡Œæ•°æ®åº“è¿ç§»ï¼š
```bash
npx prisma db push
```

---

### é—®é¢˜ï¼šè®¤è¯å¤±è´¥

**ç—‡çŠ¶**ï¼š
```
Error: æœªæˆæƒ
```

**è§£å†³**ï¼š
æ£€æŸ¥ `AUTH_SECRET` ç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®

---

## âœ… æ£€æŸ¥æ¸…å•

- [ ] Vercel ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] DATABASE_URL æ ¼å¼æ­£ç¡®
- [ ] AUTH_SECRET å·²é…ç½®
- [ ] package.json åŒ…å« `prisma generate`
- [ ] æ•°æ®åº“è¡¨å·²åˆ›å»º
- [ ] Prisma Client å·²ç”Ÿæˆ
- [ ] é‡æ–°éƒ¨ç½²åæµ‹è¯•
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ— é”™è¯¯
- [ ] Vercel å‡½æ•°æ—¥å¿—æ— é”™è¯¯

å®Œæˆæ‰€æœ‰æ£€æŸ¥åï¼Œé—®é¢˜åº”è¯¥å°±è§£å†³äº†ï¼ğŸ‰
