generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Category {
  id   String @id
  name String @unique
  Note Note[]
}

model Collaborator {
  id        String   @id
  noteId    String
  userId    String
  role      String
  createdAt DateTime @default(now())
  Note      Note     @relation(fields: [noteId], references: [id], onDelete: Cascade)
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([noteId, userId])
  @@index([noteId])
  @@index([userId])
}

model Folder {
  id           String   @id
  name         String
  parentId     String?
  userId       String
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  sortOrder    Int      @default(0)
  Folder       Folder?  @relation("FolderToFolder", fields: [parentId], references: [id], onDelete: Cascade)
  other_Folder Folder[] @relation("FolderToFolder")
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  Note         Note[]

  @@index([parentId])
  @@index([parentId, sortOrder])
  @@index([userId])
}

model Note {
  id                      String         @id
  title                   String
  content                 String
  summary                 String?
  embedding               String?
  userId                  String
  categoryId              String?
  createdAt               DateTime       @default(now())
  updatedAt               DateTime
  contentType             String         @default("tiptap-json")
  folderId                String?
  ownerId                 String
  isPublic                Boolean        @default(false)
  publicSlug              String?        @unique
  sortOrder               Int            @default(0)
  Collaborator            Collaborator[]
  Category                Category?      @relation(fields: [categoryId], references: [id])
  Folder                  Folder?        @relation(fields: [folderId], references: [id])
  User_Note_ownerIdToUser User           @relation("Note_ownerIdToUser", fields: [ownerId], references: [id])
  User_Note_userIdToUser  User           @relation("Note_userIdToUser", fields: [userId], references: [id], onDelete: Cascade)
  NoteVersion             NoteVersion[]
  Tag                     Tag[]

  @@index([categoryId])
  @@index([createdAt])
  @@index([folderId])
  @@index([folderId, sortOrder])
  @@index([ownerId])
  @@index([publicSlug])
  @@index([updatedAt])
  @@index([userId, createdAt])
  @@index([userId])
}

model NoteTemplate {
  id          String   @id
  name        String
  description String?
  content     String
  userId      String
  usageCount  Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([userId])
}

model NoteVersion {
  id        String   @id
  noteId    String
  content   String
  title     String
  userId    String
  createdAt DateTime @default(now())
  Note      Note     @relation(fields: [noteId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([noteId])
}

model Tag {
  id   String @id
  name String @unique
  Note Note[]
}

model User {
  id                      String          @id
  email                   String          @unique
  password                String
  name                    String?
  createdAt               DateTime        @default(now())
  updatedAt               DateTime
  avatar                  String?
  color                   String?
  webhookUrl              String?
  Collaborator            Collaborator[]
  Folder                  Folder[]
  Note_Note_ownerIdToUser Note[]          @relation("Note_ownerIdToUser")
  Note_Note_userIdToUser  Note[]          @relation("Note_userIdToUser")
  UserPreference          UserPreference?

  @@index([email])
}

model UserPreference {
  id        String   @id
  userId    String   @unique
  sortBy    String   @default("updatedAt")
  sortOrder String   @default("desc")
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}
