# ⚡ 快速修复指南 - 一页搞定所有问题

## 🚨 看到什么错误？

### 1️⃣ `MissingSecret: Please define a secret`

**3 步修复**：
```bash
# 1. 生成密钥
openssl rand -base64 32

# 2. 在 Vercel 添加环境变量
# Settings → Environment Variables → Add
# Name: AUTH_SECRET
# Value: 粘贴生成的密钥

# 3. 重新部署
git push
```

📖 详细文档：[紧急修复-AUTH_SECRET.md](./紧急修复-AUTH_SECRET.md)

---

### 2️⃣ 注册/登录返回 500 错误（PrismaClientInitializationError）

**原因**：Vercel 上没有配置环境变量

**3 步修复**：
```bash
# 1. 在 Vercel 添加环境变量（最重要！）
# Settings → Environment Variables
# 添加 DATABASE_URL, AUTH_SECRET 等（见下方清单）

# 2. 在 Supabase SQL Editor 运行
# 复制 supabase-setup.sql 的内容并执行

# 3. 重新部署
git push
```

📖 详细文档：
- [紧急修复-Vercel环境变量.md](./紧急修复-Vercel环境变量.md) ⭐ 最重要
- [修复-注册500错误.md](./修复-注册500错误.md)

---

### 3️⃣ 组件空白或闪烁

**已修复**，只需重新部署：
```bash
git push
```

📖 详细文档：[QUICK_FIX.md](./QUICK_FIX.md)

---

## 📋 完整环境变量清单

在 Vercel 配置以下所有变量：

```bash
# 认证（必需）
AUTH_SECRET=生成的密钥

# Supabase 公共配置（必需）
NEXT_PUBLIC_SUPABASE_URL=https://PROJECT.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGci...

# Supabase 私密配置（必需）
SUPABASE_SERVICE_ROLE_KEY=eyJhbGci...
SUPABASE_JWT_SECRET=密钥

# 数据库连接（必需）
DATABASE_URL=postgresql://postgres:PASSWORD@db.PROJECT.supabase.co:6543/postgres?pgbouncer=true
DIRECT_URL=postgresql://postgres:PASSWORD@db.PROJECT.supabase.co:5432/postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=你的密码

# AI 功能（可选）
DEEPSEEK_API_KEY=sk-...
DEEPSEEK_API_URL=https://api.deepseek.com/v1
```

---

## 🔧 快速检查命令

```bash
# 检查环境变量
npm run check:env

# 测试构建
npm run build

# 测试生产环境
npm start
```

---

## 📊 部署流程

```
1. 配置环境变量
   ↓
2. 运行数据库 SQL
   ↓
3. 提交代码
   ↓
4. 等待部署（2-3 分钟）
   ↓
5. 验证功能
```

---

## ✅ 验证清单

部署后检查：

- [ ] 访问网站无错误
- [ ] 可以注册新用户
- [ ] 可以登录
- [ ] 可以创建笔记
- [ ] 浏览器控制台无错误

---

## 🆘 仍然有问题？

### 快速诊断

1. **打开浏览器 F12**
   - Console 标签：查看错误
   - Network 标签：查看请求

2. **查看 Vercel 日志**
   - Deployments → Functions
   - 查找红色错误

3. **检查 Supabase**
   - Table Editor：确认表存在
   - SQL Editor：测试查询

### 查看文档

- 🚨 [紧急修复-AUTH_SECRET.md](./紧急修复-AUTH_SECRET.md)
- 🚨 [修复-注册500错误.md](./修复-注册500错误.md)
- 📚 [文档导航.md](./文档导航.md) - 所有文档索引
- 🔧 [TROUBLESHOOTING.md](./TROUBLESHOOTING.md) - 详细排查

---

## 💡 常见问题

**Q: 添加环境变量后还是不行？**  
A: 必须重新部署才能生效！

**Q: 数据库连接失败？**  
A: 检查 DATABASE_URL 格式，端口应该是 6543

**Q: 注册返回 500？**  
A: 先在 Supabase 运行 SQL 创建表

**Q: 组件空白？**  
A: 已修复，重新部署即可

---

## 🎯 记住这些

1. ✅ 环境变量改了要重新部署
2. ✅ 数据库表要先创建
3. ✅ DATABASE_URL 端口是 6543
4. ✅ 遇到问题先看日志

---

**快速链接**：
- [文档导航](./文档导航.md) - 找到你需要的文档
- [README](./README.md) - 项目说明
- [Vercel Dashboard](https://vercel.com/dashboard) - 部署管理
- [Supabase Dashboard](https://supabase.com/dashboard) - 数据库管理
