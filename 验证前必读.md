# ⚠️ 验证前必读 - 重要提示

## 🔴 数据库状态检查

在开始验证离线同步功能之前，**必须先确保 Supabase 数据库处于活跃状态**。

---

## 📋 验证前检查清单

### ✅ 第 1 步：恢复 Supabase 数据库（最重要！）

1. **访问 Supabase Dashboard**
   ```
   https://supabase.com/dashboard/project/llroqdgpohslhfejwxrn
   ```

2. **检查项目状态**
   - 查看页面顶部的状态指示器
   - 如果显示 **"Paused"** 或 **"Inactive"**
   - 点击 **"Resume"** 或 **"Restore"** 按钮

3. **等待数据库启动**
   - 通常需要 1-2 分钟
   - 等待状态变为 **"Active"** 或 **"Healthy"**

4. **验证连接**
   ```bash
   cd note-app
   npm run db:test
   ```

   **预期输出：**
   ```
   ✅ 数据库连接成功！
   📊 数据统计:
      - 用户数: 3
      - 笔记数: 2
   🎉 数据库连接测试通过！
   ```

---

### ✅ 第 2 步：确认环境变量

```bash
# 检查 .env 文件是否存在
type .env

# 应该看到：
DATABASE_URL="postgresql://postgres:151692483515156555878@db.llroqdgpohslhfejwxrn.supabase.co:6543/postgres?pgbouncer=true"
DIRECT_URL="postgresql://postgres:151692483515156555878@db.llroqdgpohslhfejwxrn.supabase.co:5432/postgres"
```

---

### ✅ 第 3 步：运行自动验证

```bash
npm run verify:sync
```

**只有当数据库连接成功后，才能继续后续验证！**

---

## 🚨 常见问题

### 问题：数据库连接失败

**症状：**
```
❌ 数据库连接失败
❌ Can't reach database server at `db.llroqdgpohslhfejwxrn.supabase.co:5432`
```

**原因：**
- Supabase 免费版数据库在 7 天无活动后自动暂停

**解决方案：**
1. 访问 Supabase Dashboard
2. 点击 "Resume" 按钮
3. 等待 1-2 分钟
4. 重新运行 `npm run db:test`

---

### 问题：数据库已恢复但仍然无法连接

**可能原因：**
1. 数据库刚恢复，还在启动中
2. 网络问题
3. 密码错误

**解决步骤：**

```bash
# 1. 等待 2 分钟后重试
npm run db:test

# 2. 检查网络连接
npm run verify:network

# 3. 如果仍然失败，重置数据库密码
# 访问：https://supabase.com/dashboard/project/llroqdgpohslhfejwxrn/settings/database
# 点击 "Reset Database Password"
# 更新 .env 文件中的密码
```

---

## 📊 验证流程图

```
开始
  ↓
访问 Supabase Dashboard
  ↓
检查项目状态
  ↓
是否显示 "Paused"？
  ├─ 是 → 点击 "Resume" → 等待 1-2 分钟
  └─ 否 → 继续
  ↓
运行 npm run db:test
  ↓
连接成功？
  ├─ 是 → 运行 npm run verify:sync → 开始功能验证
  └─ 否 → 查看错误信息 → 按照故障排除步骤操作
```

---

## ✅ 准备就绪检查

在开始验证前，确保以下所有项都已完成：

- [ ] Supabase 项目状态为 "Active"
- [ ] 运行 `npm run db:test` 成功
- [ ] 运行 `npm run verify:sync` 全部通过
- [ ] 已安装所有依赖 (`npm install`)
- [ ] 已生成 Prisma Client (`npm run db:generate`)

---

## 🎯 快速命令参考

```bash
# 1. 检查数据库连接
npm run db:test

# 2. 检查网络连接
npm run verify:network

# 3. 运行自动验证
npm run verify:sync

# 4. 启动开发服务器
npm run dev

# 5. 生成 Prisma Client
npm run db:generate

# 6. 同步数据库结构
npm run db:push
```

---

## 📞 需要帮助？

如果按照以上步骤仍然无法解决问题，请提供：

1. **Supabase Dashboard 截图**
   - 显示项目状态的页面

2. **数据库测试输出**
   ```bash
   npm run db:test > db-test-log.txt
   ```

3. **网络诊断输出**
   ```bash
   npm run verify:network > network-log.txt
   ```

4. **环境变量检查**（隐藏密码）
   ```bash
   # 显示前 50 个字符
   echo $env:DATABASE_URL.Substring(0, 50)
   ```

---

## 🎉 准备好了？

确认以上所有检查项都通过后，继续阅读：
- `快速验证指南.md` - 3 步快速验证
- `离线同步功能验证指南.md` - 完整测试方案

---

**记住：数据库必须处于活跃状态才能进行验证！** 🔥
